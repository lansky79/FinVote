<!-- pages/wallet/wallet.wxml -->
<view class="container">
  <!-- é’±åŒ…å¤´éƒ¨ -->
  <view class="wallet-header">
    <view class="network-status">
      <view class="status-dot {{networkStatus.isConnected ? 'connected' : 'disconnected'}}"></view>
      <text class="network-name">{{networkStatus.networkName || 'TBaaS ä¸»ç½‘'}}</text>
    </view>
    
    <view class="wallet-address">
      <text class="address-label">é’±åŒ…åœ°å€</text>
      <view class="address-row" bindtap="copyAddress">
        <text class="address-text">{{formatAddress(walletInfo.address)}}</text>
        <text class="copy-icon">ğŸ“‹</text>
      </view>
    </view>
  </view>

  <!-- ä»£å¸ä½™é¢å¡ç‰‡ -->
  <view class="balance-card">
    <view class="balance-header">
      <image class="token-logo" src="/images/svt-logo.png" mode="aspectFit"></image>
      <view class="token-info">
        <text class="token-name">Stock Vote Token</text>
        <text class="token-symbol">SVT</text>
      </view>
    </view>
    
    <view class="balance-amount">
      <text class="amount-number">{{walletInfo.balance || 0}}</text>
      <text class="amount-unit">SVT</text>
    </view>
    
    <view class="balance-value">
      <text class="value-text">â‰ˆ ${{((walletInfo.balance || 0) * 0.1).toFixed(2)}} USD</text>
      <text class="price-change {{priceChange >= 0 ? 'positive' : 'negative'}}">
        {{priceChange >= 0 ? '+' : ''}}{{priceChange}}%
      </text>
    </view>
  </view>

  <!-- å¿«é€Ÿæ“ä½œ -->
  <view class="quick-actions">
    <view class="action-item" bindtap="showMintDemo">
      <view class="action-icon mint-icon">âš¡</view>
      <text class="action-text">è·å–ä»£å¸</text>
    </view>
    
    <view class="action-item" bindtap="showTransferDemo">
      <view class="action-icon transfer-icon">ğŸ’¸</view>
      <text class="action-text">è½¬è´¦</text>
    </view>
    
    <view class="action-item" bindtap="showContractDemo">
      <view class="action-icon contract-icon">ğŸ“‹</view>
      <text class="action-text">åˆçº¦è°ƒç”¨</text>
    </view>
    
    <view class="action-item" bindtap="goToExplorer">
      <view class="action-icon explorer-icon">ğŸ”</view>
      <text class="action-text">åŒºå—æµè§ˆå™¨</text>
    </view>
  </view>

  <!-- åŒºå—é“¾ç»Ÿè®¡ -->
  <view class="blockchain-stats card">
    <view class="stats-header">
      <text class="stats-title">åŒºå—é“¾ç½‘ç»œçŠ¶æ€</text>
      <view class="refresh-btn" bindtap="refreshNetworkStatus">
        <text class="refresh-icon {{refreshing ? 'rotating' : ''}}">ğŸ”„</text>
      </view>
    </view>
    
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-label">å½“å‰åŒºå—é«˜åº¦</text>
        <text class="stat-value">{{networkStatus.blockHeight || 0}}</text>
      </view>
      
      <view class="stat-item">
        <text class="stat-label">å¾…ç¡®è®¤äº¤æ˜“</text>
        <text class="stat-value">{{networkStatus.pendingTransactions || 0}}</text>
      </view>
      
      <view class="stat-item">
        <text class="stat-label">Gas ä»·æ ¼</text>
        <text class="stat-value">{{networkStatus.gasPrice || '0.000001'}}</text>
      </view>
      
      <view class="stat-item">
        <text class="stat-label">æœ€æ–°åŒºå—æ—¶é—´</text>
        <text class="stat-value">{{formatTime(networkStatus.lastBlockTime)}}</text>
      </view>
    </view>
  </view>

  <!-- äº¤æ˜“å†å² -->
  <view class="transaction-section">
    <view class="section-header">
      <text class="section-title">äº¤æ˜“è®°å½•</text>
      <text class="view-all" bindtap="goToTransactionHistory">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    
    <view class="transaction-list">
      <view 
        class="transaction-item" 
        wx:for="{{recentTransactions}}" 
        wx:key="hash"
        bindtap="showTransactionDetail"
        data-hash="{{item.hash}}"
      >
        <view class="tx-icon-wrapper">
          <view class="tx-icon {{item.type.toLowerCase()}}">
            {{getTransactionIcon(item.type)}}
          </view>
          <view class="tx-status {{item.status}}"></view>
        </view>
        
        <view class="tx-info">
          <text class="tx-type">{{item.typeText}}</text>
          <text class="tx-time">{{item.timeText}}</text>
          <text class="tx-reason" wx:if="{{item.reason}}">{{item.reason}}</text>
        </view>
        
        <view class="tx-amount">
          <text class="amount-text {{item.isIncoming ? 'positive' : 'negative'}}">
            {{item.amountText}}
          </text>
          <text class="tx-hash">{{formatTxHash(item.hash)}}</text>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-transactions" wx:if="{{recentTransactions.length === 0}}">
      <text class="empty-text">æš‚æ— äº¤æ˜“è®°å½•</text>
      <button class="btn-primary" bindtap="showMintDemo">è·å–ç¬¬ä¸€ç¬”ä»£å¸</button>
    </view>
  </view>

  <!-- å®æ—¶äº¤æ˜“çŠ¶æ€ -->
  <view class="live-status" wx:if="{{pendingTx}}">
    <view class="status-card">
      <view class="status-header">
        <text class="status-title">äº¤æ˜“å¤„ç†ä¸­...</text>
        <view class="loading-spinner"></view>
      </view>
      
      <view class="status-info">
        <text class="tx-hash-label">äº¤æ˜“å“ˆå¸Œ:</text>
        <text class="tx-hash-value">{{formatTxHash(pendingTx.hash)}}</text>
      </view>
      
      <view class="status-progress">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{pendingTx.progress}}%"></view>
        </view>
        <text class="progress-text">é¢„è®¡ {{pendingTx.estimatedTime}} ç¡®è®¤</text>
      </view>
    </view>
  </view>
</view>

<!-- é“¸é€ ä»£å¸å¼¹çª— -->
<view class="modal-overlay {{showMintModal ? 'show' : ''}}" bindtap="hideMintModal">
  <view class="modal-content" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">è·å– SVT ä»£å¸</text>
      <text class="modal-close" bindtap="hideMintModal">Ã—</text>
    </view>
    
    <view class="modal-body">
      <view class="mint-options">
        <view 
          class="mint-option {{selectedMintOption === index ? 'selected' : ''}}"
          wx:for="{{mintOptions}}" 
          wx:key="id"
          bindtap="selectMintOption"
          data-index="{{index}}"
        >
          <text class="option-title">{{item.title}}</text>
          <text class="option-amount">+{{item.amount}} SVT</text>
          <text class="option-desc">{{item.description}}</text>
        </view>
      </div>
    </view>
    
    <view class="modal-footer">
      <button 
        class="btn-primary mint-btn"
        bindtap="executeMint"
        disabled="{{minting}}"
      >
        {{minting ? 'å¤„ç†ä¸­...' : 'ç«‹å³è·å–'}}
      </button>
    </view>
  </view>
</view>

<!-- è½¬è´¦å¼¹çª— -->
<view class="modal-overlay {{showTransferModal ? 'show' : ''}}" bindtap="hideTransferModal">
  <view class="modal-content" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">è½¬è´¦ SVT</text>
      <text class="modal-close" bindtap="hideTransferModal">Ã—</text>
    </view>
    
    <view class="modal-body">
      <view class="form-item">
        <text class="form-label">æ¥æ”¶åœ°å€</text>
        <input 
          class="form-input" 
          placeholder="è¾“å…¥æ¥æ”¶æ–¹ç”¨æˆ·IDæˆ–åœ°å€"
          value="{{transferForm.toAddress}}"
          bindinput="handleTransferInput"
          data-field="toAddress"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">è½¬è´¦æ•°é‡</text>
        <input 
          class="form-input" 
          type="number"
          placeholder="è¾“å…¥è½¬è´¦æ•°é‡"
          value="{{transferForm.amount}}"
          bindinput="handleTransferInput"
          data-field="amount"
        />
        <text class="balance-hint">ä½™é¢: {{walletInfo.balance}} SVT</text>
      </view>
      
      <view class="form-item">
        <text class="form-label">å¤‡æ³¨ (å¯é€‰)</text>
        <input 
          class="form-input" 
          placeholder="è½¬è´¦å¤‡æ³¨"
          value="{{transferForm.memo}}"
          bindinput="handleTransferInput"
          data-field="memo"
        />
      </view>
    </view>
    
    <view class="modal-footer">
      <button 
        class="btn-primary transfer-btn"
        bindtap="executeTransfer"
        disabled="{{transferring || !canTransfer}}"
      >
        {{transferring ? 'å¤„ç†ä¸­...' : 'ç¡®è®¤è½¬è´¦'}}
      </button>
    </view>
  </view>
</view>