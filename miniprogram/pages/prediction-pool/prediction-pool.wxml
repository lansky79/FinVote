<!-- pages/prediction-pool/prediction-pool.wxml -->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">é¢„æµ‹èµ„é‡‘æ± </text>
    <text class="page-desc">æ™ºèƒ½åˆçº¦é©±åŠ¨çš„å¤šäººé¢„æµ‹æ¸¸æˆ</text>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tab-bar">
    <view 
      class="tab-item {{activeTab === 'active' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="active"
    >
      <text>è¿›è¡Œä¸­</text>
    </view>
    <view 
      class="tab-item {{activeTab === 'my' ? 'active' : ''}}" 
      bindtap="switchTab" 
      data-tab="my"
    >
      <text>æˆ‘çš„èµ„é‡‘æ± </text>
    </view>
  </view>

  <!-- åˆ›å»ºæŒ‰é’® -->
  <view class="create-section">
    <button class="btn-primary create-btn" bindtap="showCreatePool">
      <text class="btn-icon">ğŸ’°</text>
      <text>åˆ›å»ºé¢„æµ‹æ± </text>
    </button>
  </view>

  <!-- èµ„é‡‘æ± åˆ—è¡¨ -->
  <view class="pool-list" wx:if="{{!loading}}">
    <view class="pool-item card" wx:for="{{pools}}" wx:key="id">
      <view class="pool-header">
        <view class="pool-info">
          <text class="pool-title">{{item.title}}</text>
          <text class="stock-info">{{item.stockCode}} - {{item.stockName}}</text>
        </view>
        <view class="pool-status">
          <text class="status-badge {{item.status}}">{{item.statusText}}</text>
        </view>
      </view>

      <view class="pool-details">
        <view class="detail-row">
          <text class="detail-label">ç›®æ ‡ä»·æ ¼:</text>
          <text class="detail-value">Â¥{{item.targetPrice}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">å½“å‰ä»·æ ¼:</text>
          <text class="detail-value">Â¥{{item.currentPrice}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">å¥–æ± æ€»é¢:</text>
          <text class="detail-value prize-pool">{{item.totalPool}}ç§¯åˆ†</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">å‚ä¸äººæ•°:</text>
          <text class="detail-value">{{item.participants}}äºº</text>
        </view>
      </view>

      <view class="prediction-stats">
        <view class="stat-item">
          <text class="stat-label">çœ‹æ¶¨</text>
          <text class="stat-value up">{{item.upCount}}äºº</text>
          <text class="stat-amount">{{item.upAmount}}ç§¯åˆ†</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-label">çœ‹è·Œ</text>
          <text class="stat-value down">{{item.downCount}}äºº</text>
          <text class="stat-amount">{{item.downAmount}}ç§¯åˆ†</text>
        </view>
      </view>

      <view class="pool-time">
        <text class="time-text">{{item.endTimeText}}</text>
      </view>

      <view class="pool-actions">
        <button class="btn-outline" bindtap="viewPool" data-id="{{item.id}}">
          æŸ¥çœ‹è¯¦æƒ…
        </button>
        <button 
          class="btn-primary" 
          wx:if="{{item.status === 'active' && !item.userJoined}}"
          bindtap="joinPool" 
          data-id="{{item.id}}"
        >
          åŠ å…¥é¢„æµ‹
        </button>
        <button 
          class="btn-success" 
          wx:if="{{item.userJoined}}"
          disabled
        >
          å·²å‚ä¸
        </button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && pools.length === 0}}">
    <text class="empty-icon">ğŸ’°</text>
    <text class="empty-text">
      {{activeTab === 'active' ? 'æš‚æ— è¿›è¡Œä¸­çš„é¢„æµ‹æ± ' : 'æ‚¨è¿˜æ²¡æœ‰åˆ›å»ºé¢„æµ‹æ± '}}
    </text>
    <text class="empty-desc">
      {{activeTab === 'active' ? 'åˆ›å»ºä¸€ä¸ªé¢„æµ‹æ± å¼€å§‹æ¸¸æˆå§' : 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªé¢„æµ‹æ± '}}
    </text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- åˆ›å»ºå¼¹çª— -->
<view class="modal" wx:if="{{showCreateModal}}">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">åˆ›å»ºé¢„æµ‹æ± </text>
      <text class="modal-close" bindtap="hideCreateModal">âœ•</text>
    </view>
    
    <view class="form-group">
      <text class="form-label">é¢„æµ‹æ ‡é¢˜</text>
      <input 
        class="form-input" 
        placeholder="ä¾‹å¦‚ï¼šå¹³å®‰é“¶è¡Œæ˜æ—¥æ”¶ç›˜ä»·é¢„æµ‹"
        value="{{createForm.title}}"
        bindinput="onFormInput"
        data-field="title"
      />
    </view>

    <view class="form-row">
      <view class="form-group half">
        <text class="form-label">è‚¡ç¥¨ä»£ç </text>
        <input 
          class="form-input" 
          placeholder="000001"
          value="{{createForm.stockCode}}"
          bindinput="onFormInput"
          data-field="stockCode"
        />
      </view>
      <view class="form-group half">
        <text class="form-label">è‚¡ç¥¨åç§°</text>
        <input 
          class="form-input" 
          placeholder="å¹³å®‰é“¶è¡Œ"
          value="{{createForm.stockName}}"
          bindinput="onFormInput"
          data-field="stockName"
        />
      </view>
    </view>

    <view class="form-group">
      <text class="form-label">ç›®æ ‡ä»·æ ¼</text>
      <input 
        class="form-input" 
        placeholder="12.50"
        type="digit"
        value="{{createForm.targetPrice}}"
        bindinput="onFormInput"
        data-field="targetPrice"
      />
    </view>

    <view class="form-group">
      <text class="form-label">ç»“æŸæ—¶é—´</text>
      <picker 
        mode="datetime" 
        value="{{createForm.endTime}}" 
        bindchange="onFormInput"
        data-field="endTime"
      >
        <view class="picker-view">
          {{createForm.endTime || 'é€‰æ‹©ç»“æŸæ—¶é—´'}}
        </view>
      </picker>
    </view>

    <view class="form-row">
      <view class="form-group half">
        <text class="form-label">æœ€å°æŠ•æ³¨</text>
        <input 
          class="form-input" 
          type="number"
          value="{{createForm.minStake}}"
          bindinput="onFormInput"
          data-field="minStake"
        />
      </view>
      <view class="form-group half">
        <text class="form-label">æœ€å¤§æŠ•æ³¨</text>
        <input 
          class="form-input" 
          type="number"
          value="{{createForm.maxStake}}"
          bindinput="onFormInput"
          data-field="maxStake"
        />
      </view>
    </view>

    <view class="modal-actions">
      <button class="btn-outline" bindtap="hideCreateModal">å–æ¶ˆ</button>
      <button class="btn-primary" bindtap="createPool">åˆ›å»º</button>
    </view>
  </view>
</view>