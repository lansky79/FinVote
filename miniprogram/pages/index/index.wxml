<!-- pages/index/index.wxml -->
<view class="container">
  <!-- 用户信息卡片 -->
  <view class="card user-info" wx:if="{{userInfo}}">
    <view class="flex-between">
      <view class="flex">
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view class="user-details">
          <text class="username">{{userInfo.nickName}}</text>
          <text class="points">积分: {{userInfo.points || 0}}</text>
        </view>
      </view>
      <view class="rank-info">
        <text class="rank-text">排名: {{userInfo.rank || '-'}}</text>
      </view>
    </view>
  </view>

  <!-- 登录提示 -->
  <view class="card login-prompt" wx:if="{{!userInfo}}">
    <view class="flex-center flex-column">
      <text class="login-title">欢迎来到股票投票</text>
      <text class="login-desc text-muted">登录后开始预测股票涨跌，赢取积分</text>
      <button class="btn-primary" bindtap="handleLogin">微信登录</button>
    </view>
  </view>

  <!-- 统计信息 -->
  <view class="stats-grid">
    <view class="stat-item card">
      <text class="stat-number text-primary">{{stats.totalVotes || 0}}</text>
      <text class="stat-label">总投票</text>
    </view>
    <view class="stat-item card">
      <text class="stat-number text-success">{{stats.correctVotes || 0}}</text>
      <text class="stat-label">预测正确</text>
    </view>
    <view class="stat-item card">
      <text class="stat-number">{{stats.accuracy || '0%'}}</text>
      <text class="stat-label">准确率</text>
    </view>
  </view>

  <!-- 热门投票 - 紧凑显示 -->
  <view class="section">
    <view class="section-header flex-between">
      <text class="section-title">热门投票</text>
      <text class="more-link text-primary" bindtap="goToVote">更多</text>
    </view>
    
    <view class="vote-list">
      <view class="vote-item-compact card" wx:for="{{hotVotes}}" wx:key="id" wx:if="{{index < 2}}" bindtap="goToVoteDetail" data-id="{{item.id}}">
        <view class="vote-compact-header">
          <text class="vote-compact-title">{{item.title}}</text>
          <text class="vote-status {{item.status === 'active' ? 'text-success' : 'text-muted'}}">
            {{item.status === 'active' ? '进行中' : '已结束'}}
          </text>
        </view>
        <view class="vote-compact-info">
          <text class="stock-code text-primary">{{item.stockCode}}</text>
          <text class="vote-status-text {{item.userVoted ? 'text-success' : 'text-primary'}}">
            {{item.userVoted ? '已投票' : '可投票'}}
          </text>
        </view>
      </view>
      
      <!-- 无数据提示 -->
      <view class="no-data card" wx:if="{{hotVotes.length === 0}}">
        <text class="no-data-text text-muted">暂无热门投票</text>
      </view>
    </view>
  </view>

  <!-- 快速操作 - 网格布局 -->
  <view class="quick-actions-grid">
    <button class="action-btn-grid btn-primary" bindtap="goToCreateVote">
      <text class="action-icon">📊</text>
      <text class="action-text">创建投票</text>
    </button>
    <button class="action-btn-grid btn-secondary" bindtap="goToVote">
      <text class="action-icon">📈</text>
      <text class="action-text">投票大厅</text>
    </button>
    <button class="action-btn-grid btn-secondary" bindtap="goToLottery">
      <text class="action-icon">🎰</text>
      <text class="action-text">转盘抽奖</text>
    </button>
    <button class="action-btn-grid btn-secondary" bindtap="goToShop">
      <text class="action-icon">🛒</text>
      <text class="action-text">积分商城</text>
    </button>
    <button class="action-btn-grid btn-secondary" bindtap="goToSmartContract">
      <text class="action-icon">📜</text>
      <text class="action-text">智能合约</text>
    </button>
    <button class="action-btn-grid btn-secondary" bindtap="goToBlockchainDemo">
      <text class="action-icon">🔗</text>
      <text class="action-text">区块链</text>
    </button>
  </view>
</view>