<!-- pages/blockchain-demo/blockchain-demo.wxml -->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="demo-header">
    <text class="demo-title">åŒºå—é“¾å­˜è¯æ¼”ç¤º</text>
    <text class="demo-subtitle">ä½“éªŒçœŸå®çš„åŒºå—é“¾ä¸Šé“¾è¿‡ç¨‹</text>
  </view>

  <!-- ç½‘ç»œçŠ¶æ€ -->
  <view class="network-status card">
    <view class="status-header">
      <view class="status-dot {{networkConnected ? 'connected' : 'disconnected'}}"></view>
      <text class="network-name">è…¾è®¯äº‘ TBaaS è”ç›Ÿé“¾</text>
      <text class="refresh-btn" bindtap="refreshNetwork">ğŸ”„</text>
    </view>
    <view class="network-info">
      <text class="info-text">é›†ç¾¤ID: {{clusterInfo.clusterId}}</text>
      <text class="info-text">é€šé“: {{clusterInfo.channelName}}</text>
    </view>
  </view>

  <!-- æ¼”ç¤ºæ“ä½œåŒº -->
  <view class="demo-actions">
    
    <!-- æ¨¡æ‹ŸæŠ•ç¥¨ä¸Šé“¾ -->
    <view class="action-card card">
      <view class="action-header">
        <text class="action-title">ğŸ“Š æŠ•ç¥¨æ•°æ®ä¸Šé“¾</text>
        <text class="action-desc">å°†æŠ•ç¥¨è®°å½•å­˜å‚¨åˆ°åŒºå—é“¾</text>
      </view>
      
      <view class="action-form">
        <view class="form-row">
          <text class="form-label">è‚¡ç¥¨ä»£ç :</text>
          <input class="form-input" value="{{demoVote.stockCode}}" bindinput="updateVoteData" data-field="stockCode" placeholder="å¦‚: 000001"/>
        </view>
        
        <view class="form-row">
          <text class="form-label">é¢„æµ‹æ–¹å‘:</text>
          <picker range="{{predictionOptions}}" value="{{demoVote.predictionIndex}}" bindchange="updatePrediction">
            <view class="picker-display">{{predictionOptions[demoVote.predictionIndex]}}</view>
          </picker>
        </view>
        
        <view class="form-row">
          <text class="form-label">åŸºå‡†ä»·æ ¼:</text>
          <input class="form-input" type="digit" value="{{demoVote.basePrice}}" bindinput="updateVoteData" data-field="basePrice" placeholder="å¦‚: 12.50"/>
        </view>
      </view>
      
      <button class="btn-primary action-btn" bindtap="submitVoteToChain" disabled="{{submittingVote}}">
        {{submittingVote ? 'ä¸Šé“¾ä¸­...' : 'æäº¤åˆ°åŒºå—é“¾'}}
      </button>
    </view>

    <!-- æ¨¡æ‹Ÿç§¯åˆ†å¥–åŠ±ä¸Šé“¾ -->
    <view class="action-card card">
      <view class="action-header">
        <text class="action-title">ğŸ’° ç§¯åˆ†å¥–åŠ±ä¸Šé“¾</text>
        <text class="action-desc">å°†ç§¯åˆ†å˜åŠ¨è®°å½•å­˜å‚¨åˆ°åŒºå—é“¾</text>
      </view>
      
      <view class="action-form">
        <view class="form-row">
          <text class="form-label">å¥–åŠ±ç±»å‹:</text>
          <picker range="{{rewardTypes}}" range-key="name" value="{{demoReward.typeIndex}}" bindchange="updateRewardType">
            <view class="picker-display">{{rewardTypes[demoReward.typeIndex].name}}</view>
          </picker>
        </view>
        
        <view class="form-row">
          <text class="form-label">ç§¯åˆ†æ•°é‡:</text>
          <input class="form-input" type="number" value="{{demoReward.points}}" bindinput="updateRewardData" data-field="points" placeholder="å¦‚: 10"/>
        </view>
        
        <view class="form-row">
          <text class="form-label">å½“å‰ç§¯åˆ†:</text>
          <text class="current-balance">{{userPoints}} ç§¯åˆ†</text>
        </view>
      </view>
      
      <button class="btn-primary action-btn" bindtap="submitRewardToChain" disabled="{{submittingReward}}">
        {{submittingReward ? 'ä¸Šé“¾ä¸­...' : 'ç§¯åˆ†ä¸Šé“¾å­˜è¯'}}
      </button>
    </view>

  </view>

  <!-- å®æ—¶äº¤æ˜“çŠ¶æ€ -->
  <view class="transaction-status" wx:if="{{currentTransaction}}">
    <view class="status-card card">
      <view class="status-header">
        <text class="status-title">â³ åŒºå—é“¾äº¤æ˜“å¤„ç†ä¸­</text>
        <view class="loading-animation">
          <view class="dot dot1"></view>
          <view class="dot dot2"></view>
          <view class="dot dot3"></view>
        </view>
      </view>
      
      <view class="transaction-info">
        <view class="info-row">
          <text class="info-label">äº¤æ˜“ç±»å‹:</text>
          <text class="info-value">{{currentTransaction.type}}</text>
        </view>
        
        <view class="info-row">
          <text class="info-label">äº¤æ˜“ID:</text>
          <text class="info-value tx-id">{{currentTransaction.txId}}</text>
        </view>
        
        <view class="info-row">
          <text class="info-label">æ•°æ®å“ˆå¸Œ:</text>
          <text class="info-value data-hash">{{currentTransaction.dataHash}}</text>
        </view>
        
        <view class="info-row">
          <text class="info-label">æäº¤æ—¶é—´:</text>
          <text class="info-value">{{currentTransaction.submitTime}}</text>
        </view>
      </view>
      
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{currentTransaction.progress}}%"></view>
      </view>
      <text class="progress-text">é¢„è®¡ {{currentTransaction.estimatedTime}} ç¡®è®¤ä¸Šé“¾</text>
    </view>
  </view>

  <!-- åŒºå—é“¾è®°å½•å†å² -->
  <view class="blockchain-history">
    <view class="history-header">
      <text class="history-title">ğŸ“‹ åŒºå—é“¾å­˜è¯è®°å½•</text>
      <text class="refresh-history" bindtap="loadChainHistory">åˆ·æ–°</text>
    </view>
    
    <view class="history-list">
      <view class="history-item card" wx:for="{{chainHistory}}" wx:key="txId" bindtap="showTransactionDetail" data-tx="{{item}}">
        <view class="history-header-row">
          <view class="tx-type-badge {{item.type}}">
            <text>{{item.typeText}}</text>
          </view>
          <view class="tx-status {{item.status}}">
            <text>{{item.statusText}}</text>
          </view>
        </view>
        
        <view class="history-content">
          <text class="tx-description">{{item.description}}</text>
          <text class="tx-time">{{item.timeText}}</text>
        </view>
        
        <view class="history-footer">
          <text class="tx-id-short">äº¤æ˜“ID: {{item.txIdShort}}</text>
          <text class="view-detail">æŸ¥çœ‹è¯¦æƒ… ></text>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-history" wx:if="{{chainHistory.length === 0}}">
      <text class="empty-text">æš‚æ— åŒºå—é“¾è®°å½•</text>
      <text class="empty-hint">è¯•è¯•ä¸Šé¢çš„æ¼”ç¤ºæ“ä½œ</text>
    </view>
  </view>

  <!-- åŒºå—é“¾æµè§ˆå™¨ -->
  <view class="blockchain-explorer card">
    <view class="explorer-header">
      <text class="explorer-title">ğŸ” åŒºå—é“¾æµè§ˆå™¨</text>
    </view>
    
    <view class="explorer-content">
      <view class="explorer-item" bindtap="openExplorer">
        <text class="explorer-label">æŸ¥çœ‹å®Œæ•´åŒºå—é“¾æ•°æ®</text>
        <text class="explorer-arrow">></text>
      </view>
      
      <view class="explorer-item" bindtap="verifyData">
        <text class="explorer-label">éªŒè¯æ•°æ®å®Œæ•´æ€§</text>
        <text class="explorer-arrow">></text>
      </view>
    </view>
  </view>
</view>

<!-- äº¤æ˜“è¯¦æƒ…å¼¹çª— -->
<view class="modal-overlay {{showTxDetail ? 'show' : ''}}" bindtap="hideTxDetail">
  <view class="modal-content" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">åŒºå—é“¾äº¤æ˜“è¯¦æƒ…</text>
      <text class="modal-close" bindtap="hideTxDetail">Ã—</text>
    </view>
    
    <view class="modal-body" wx:if="{{selectedTx}}">
      <view class="detail-section">
        <text class="section-title">åŸºæœ¬ä¿¡æ¯</text>
        <view class="detail-row">
          <text class="detail-label">äº¤æ˜“ç±»å‹:</text>
          <text class="detail-value">{{selectedTx.typeText}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">äº¤æ˜“çŠ¶æ€:</text>
          <text class="detail-value {{selectedTx.status}}">{{selectedTx.statusText}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">æäº¤æ—¶é—´:</text>
          <text class="detail-value">{{selectedTx.submitTime}}</text>
        </view>
      </view>
      
      <view class="detail-section">
        <text class="section-title">åŒºå—é“¾ä¿¡æ¯</text>
        <view class="detail-row">
          <text class="detail-label">äº¤æ˜“ID:</text>
          <text class="detail-value hash-text">{{selectedTx.txId}}</text>
        </view>
        <view class="detail-row">
          <text class="detail-label">æ•°æ®å“ˆå¸Œ:</text>
          <text class="detail-value hash-text">{{selectedTx.dataHash}}</text>
        </view>
        <view class="detail-row" wx:if="{{selectedTx.blockNumber}}">
          <text class="detail-label">åŒºå—é«˜åº¦:</text>
          <text class="detail-value">{{selectedTx.blockNumber}}</text>
        </view>
      </view>
      
      <view class="detail-section" wx:if="{{selectedTx.data}}">
        <text class="section-title">å­˜è¯æ•°æ®</text>
        <view class="data-content">
          <text class="data-text">{{selectedTx.dataPreview}}</text>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn-secondary" bindtap="copyTxId">å¤åˆ¶äº¤æ˜“ID</button>
      <button class="btn-primary" bindtap="verifyTxData">éªŒè¯æ•°æ®</button>
    </view>
  </view>
</view>