<!-- pages/profile/profile.wxml -->
<view class="container">
  <!-- 用户信息卡片 -->
  <view class="user-card card" wx:if="{{userInfo}}">
    <view class="user-header">
      <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view class="user-details">
        <text class="user-name">{{userInfo.nickName}}</text>
        <text class="user-rank text-muted">排名: {{userInfo.rank || '-'}}</text>
      </view>
      <button class="btn-edit" bindtap="editProfile">编辑</button>
    </view>
    
    <view class="user-stats">
      <view class="stat-item">
        <text class="stat-number text-primary">{{userInfo.points}}</text>
        <text class="stat-label">积分</text>
      </view>
      <view class="stat-item">
        <text class="stat-number text-success">{{userInfo.correctVotes}}</text>
        <text class="stat-label">预测正确</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{userInfo.totalVotes}}</text>
        <text class="stat-label">总投票数</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{userInfo.accuracy}}%</text>
        <text class="stat-label">准确率</text>
      </view>
    </view>
  </view>

  <!-- 登录提示 -->
  <view class="login-card card" wx:if="{{!userInfo}}">
    <view class="login-content">
      <text class="login-title">欢迎使用股票投票</text>
      <text class="login-desc text-muted">登录后享受完整功能</text>
      <button class="btn-primary" bindtap="handleLogin">微信登录</button>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section" wx:if="{{userInfo}}">
    <view class="menu-item" bindtap="goToVoteHistory">
      <view class="menu-icon">📊</view>
      <text class="menu-title">投票记录</text>
      <text class="menu-arrow">></text>
    </view>
    
    <view class="menu-item" bindtap="goToShop">
      <view class="menu-icon">🎁</view>
      <text class="menu-title">积分商城</text>
      <text class="menu-arrow">></text>
    </view>
    
    <view class="menu-item" bindtap="goToExchangeHistory">
      <view class="menu-icon">📋</view>
      <text class="menu-title">兑换记录</text>
      <text class="menu-arrow">></text>
    </view>
    
    <!-- 管理员入口 -->
    <view class="menu-item admin-entry" wx:if="{{isAdmin}}" bindtap="goToAdmin">
      <view class="menu-icon">⚙️</view>
      <text class="menu-title">管理后台</text>
      <text class="menu-arrow">></text>
    </view>
  </view>

  <!-- 最近投票 -->
  <view class="recent-votes" wx:if="{{userInfo && recentVotes.length > 0}}">
    <view class="section-header">
      <text class="section-title">最近投票</text>
      <text class="more-link text-primary" bindtap="goToVoteHistory">查看全部</text>
    </view>
    
    <view class="vote-list">
      <view class="vote-item card" wx:for="{{recentVotes}}" wx:key="id">
        <view class="vote-header">
          <text class="vote-title">{{item.vote.title}}</text>
          <view class="vote-result result-{{item.isCorrect}}">
            <text>{{item.isCorrect === true ? '预测正确' : item.isCorrect === false ? '预测错误' : '待结算'}}</text>
          </view>
        </view>
        
        <view class="vote-info">
          <text class="stock-info">{{item.vote.stockCode}} - {{item.vote.stockName}}</text>
          <text class="prediction prediction-{{item.prediction}}">
            {{item.prediction === 'up' ? '看涨' : '看跌'}}
          </text>
        </view>
        
        <view class="vote-footer">
          <text class="vote-time text-muted">{{item.voteTimeText}}</text>
          <text class="points-earned" wx:if="{{item.pointsEarned > 0}}">
            +{{item.pointsEarned}}积分
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- 成就展示 -->
  <view class="achievements" wx:if="{{userInfo}}">
    <view class="section-title">我的成就</view>
    <view class="achievement-grid">
      <view class="achievement-item {{userInfo.totalVotes >= 10 ? 'achieved' : 'locked'}}">
        <text class="achievement-icon">🎯</text>
        <text class="achievement-name">投票达人</text>
        <text class="achievement-desc">投票10次</text>
      </view>
      
      <view class="achievement-item {{userInfo.correctVotes >= 5 ? 'achieved' : 'locked'}}">
        <text class="achievement-icon">🎪</text>
        <text class="achievement-name">预测高手</text>
        <text class="achievement-desc">预测正确5次</text>
      </view>
      
      <view class="achievement-item {{userInfo.accuracy >= 60 ? 'achieved' : 'locked'}}">
        <text class="achievement-icon">🏆</text>
        <text class="achievement-name">准确之星</text>
        <text class="achievement-desc">准确率达到60%</text>
      </view>
      
      <view class="achievement-item {{userInfo.points >= 1000 ? 'achieved' : 'locked'}}">
        <text class="achievement-icon">💎</text>
        <text class="achievement-name">积分大户</text>
        <text class="achievement-desc">积分达到1000</text>
      </view>
    </view>
  </view>

  <!-- 设置菜单 -->
  <view class="settings-section">
    <view class="menu-item" bindtap="showAbout">
      <view class="menu-icon">ℹ️</view>
      <text class="menu-title">关于我们</text>
      <text class="menu-arrow">></text>
    </view>
    
    <view class="menu-item" bindtap="showFeedback">
      <view class="menu-icon">💬</view>
      <text class="menu-title">意见反馈</text>
      <text class="menu-arrow">></text>
    </view>
  </view>
</view>