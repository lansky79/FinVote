<!-- pages/profile/profile.wxml -->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card card" wx:if="{{userInfo}}">
    <view class="user-header">
      <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view class="user-details">
        <text class="user-name">{{userInfo.nickName}}</text>
        <text class="user-rank text-muted">æ’å: {{userInfo.rank || '-'}}</text>
      </view>
      <button class="btn-edit" bindtap="editProfile">ç¼–è¾‘</button>
    </view>
    
    <view class="user-stats">
      <view class="stat-item">
        <text class="stat-number text-primary">{{userInfo.points}}</text>
        <text class="stat-label">ç§¯åˆ†</text>
      </view>
      <view class="stat-item">
        <text class="stat-number text-success">{{userInfo.correctVotes}}</text>
        <text class="stat-label">é¢„æµ‹æ­£ç¡®</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{userInfo.totalVotes}}</text>
        <text class="stat-label">æ€»æŠ•ç¥¨æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{userInfo.accuracy}}%</text>
        <text class="stat-label">å‡†ç¡®ç‡</text>
      </view>
    </view>
  </view>

  <!-- ç™»å½•æç¤º -->
  <view class="login-card card" wx:if="{{!userInfo}}">
    <view class="login-content">
      <text class="login-title">æ¬¢è¿ä½¿ç”¨è‚¡ç¥¨æŠ•ç¥¨</text>
      <text class="login-desc text-muted">ç™»å½•åäº«å—å®Œæ•´åŠŸèƒ½</text>
      <button class="btn-primary" bindtap="handleLogin">å¾®ä¿¡ç™»å½•</button>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section" wx:if="{{userInfo}}">
    <view class="menu-item" bindtap="goToVoteHistory">
      <view class="menu-icon">ğŸ“Š</view>
      <text class="menu-title">æŠ•ç¥¨è®°å½•</text>
      <text class="menu-arrow">></text>
    </view>
    
    <view class="menu-item" bindtap="goToShop">
      <view class="menu-icon">ğŸ</view>
      <text class="menu-title">ç§¯åˆ†å•†åŸ</text>
      <text class="menu-arrow">></text>
    </view>
    
    <view class="menu-item" bindtap="goToExchangeHistory">
      <view class="menu-icon">ğŸ“‹</view>
      <text class="menu-title">å…‘æ¢è®°å½•</text>
      <text class="menu-arrow">></text>
    </view>
    
    <!-- ç®¡ç†å‘˜å…¥å£ -->
    <view class="menu-item admin-entry" wx:if="{{isAdmin}}" bindtap="goToAdmin">
      <view class="menu-icon">âš™ï¸</view>
      <text class="menu-title">ç®¡ç†åå°</text>
      <text class="menu-arrow">></text>
    </view>
  </view>

  <!-- æœ€è¿‘æŠ•ç¥¨ -->
  <view class="recent-votes" wx:if="{{userInfo && recentVotes.length > 0}}">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘æŠ•ç¥¨</text>
      <text class="more-link text-primary" bindtap="goToVoteHistory">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    
    <view class="vote-list">
      <view class="vote-item card" wx:for="{{recentVotes}}" wx:key="id">
        <view class="vote-header">
          <text class="vote-title">{{item.vote.title}}</text>
          <view class="vote-result result-{{item.isCorrect}}">
            <text>{{item.isCorrect === true ? 'é¢„æµ‹æ­£ç¡®' : item.isCorrect === false ? 'é¢„æµ‹é”™è¯¯' : 'å¾…ç»“ç®—'}}</text>
          </view>
        </view>
        
        <view class="vote-info">
          <text class="stock-info">{{item.vote.stockCode}} - {{item.vote.stockName}}</text>
          <text class="prediction prediction-{{item.prediction}}">
            {{item.prediction === 'up' ? 'çœ‹æ¶¨' : 'çœ‹è·Œ'}}
          </text>
        </view>
        
        <view class="vote-footer">
          <text class="vote-time text-muted">{{item.voteTimeText}}</text>
          <text class="points-earned" wx:if="{{item.pointsEarned > 0}}">
            +{{item.pointsEarned}}ç§¯åˆ†
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆå°±å±•ç¤º -->
  <view class="achievements" wx:if="{{userInfo}}">
    <view class="section-title">æˆ‘çš„æˆå°±</view>
    <view class="achievement-grid">
      <view class="achievement-item {{userInfo.totalVotes >= 10 ? 'achieved' : 'locked'}}">
        <text class="achievement-icon">ğŸ¯</text>
        <text class="achievement-name">æŠ•ç¥¨è¾¾äºº</text>
        <text class="achievement-desc">æŠ•ç¥¨10æ¬¡</text>
      </view>
      
      <view class="achievement-item {{userInfo.correctVotes >= 5 ? 'achieved' : 'locked'}}">
        <text class="achievement-icon">ğŸª</text>
        <text class="achievement-name">é¢„æµ‹é«˜æ‰‹</text>
        <text class="achievement-desc">é¢„æµ‹æ­£ç¡®5æ¬¡</text>
      </view>
      
      <view class="achievement-item {{userInfo.accuracy >= 60 ? 'achieved' : 'locked'}}">
        <text class="achievement-icon">ğŸ†</text>
        <text class="achievement-name">å‡†ç¡®ä¹‹æ˜Ÿ</text>
        <text class="achievement-desc">å‡†ç¡®ç‡è¾¾åˆ°60%</text>
      </view>
      
      <view class="achievement-item {{userInfo.points >= 1000 ? 'achieved' : 'locked'}}">
        <text class="achievement-icon">ğŸ’</text>
        <text class="achievement-name">ç§¯åˆ†å¤§æˆ·</text>
        <text class="achievement-desc">ç§¯åˆ†è¾¾åˆ°1000</text>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®èœå• -->
  <view class="settings-section">
    <view class="menu-item" bindtap="showAbout">
      <view class="menu-icon">â„¹ï¸</view>
      <text class="menu-title">å…³äºæˆ‘ä»¬</text>
      <text class="menu-arrow">></text>
    </view>
    
    <view class="menu-item" bindtap="showFeedback">
      <view class="menu-icon">ğŸ’¬</view>
      <text class="menu-title">æ„è§åé¦ˆ</text>
      <text class="menu-arrow">></text>
    </view>
  </view>
</view>