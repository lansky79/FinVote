<!-- pages/contract-store/contract-store.wxml -->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æ™ºèƒ½åˆçº¦å•†åº—</text>
    <text class="page-desc">æŒ‰éœ€è´­ä¹°ï¼Œå³ä¹°å³ç”¨</text>
  </view>

  <!-- å¥—é¤æ¨è -->
  <view class="package-banner" bindtap="viewPackages">
    <view class="banner-content">
      <text class="banner-title">ğŸ‰ å¥—é¤ä¼˜æƒ </text>
      <text class="banner-desc">è´­ä¹°å¥—é¤æœ€é«˜çœÂ¥264</text>
    </view>
    <text class="banner-arrow">></text>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-tabs">
    <view 
      class="tab-item {{activeCategory === item.id ? 'active' : ''}}"
      wx:for="{{categories}}" 
      wx:key="id"
      bindtap="switchCategory"
      data-id="{{item.id}}"
    >
      <text class="tab-icon">{{item.icon}}</text>
      <text class="tab-name">{{item.name}}</text>
    </view>
  </view>

  <!-- åˆçº¦åˆ—è¡¨ -->
  <view class="contract-list">
    <block wx:for="{{categories}}" wx:key="id">
      <view class="category-section" wx:if="{{activeCategory === item.id}}">
        <view 
          class="contract-card {{contract.isPurchased ? 'purchased' : ''}}"
          wx:for="{{item.contracts}}" 
          wx:for-item="contract"
          wx:key="id"
          bindtap="viewContract"
          data-id="{{contract.id}}"
        >
          <!-- çƒ­é—¨æ ‡ç­¾ -->
          <view class="popular-tag" wx:if="{{contract.popular}}">
            <text>ğŸ”¥ çƒ­é—¨</text>
          </view>

          <!-- å…è´¹æ ‡ç­¾ -->
          <view class="free-tag" wx:if="{{contract.isFree}}">
            <text>å…è´¹</text>
          </view>

          <!-- å·²è´­ä¹°æ ‡ç­¾ -->
          <view class="purchased-tag" wx:if="{{contract.isPurchased}}">
            <text>âœ… å·²è´­ä¹°</text>
          </view>

          <view class="contract-header">
            <text class="contract-name">{{contract.name}}</text>
            <view class="contract-price">
              <text class="current-price" wx:if="{{!contract.isFree}}">Â¥{{contract.price}}</text>
              <text class="original-price" wx:if="{{contract.originalPrice > contract.price}}">Â¥{{contract.originalPrice}}</text>
              <text class="free-price" wx:if="{{contract.isFree}}">å…è´¹</text>
            </view>
          </view>

          <view class="contract-desc">
            <text>{{contract.description}}</text>
          </view>

          <view class="contract-features">
            <view class="feature-item" wx:for="{{contract.features}}" wx:key="*this">
              <text class="feature-dot">â€¢</text>
              <text class="feature-text">{{item}}</text>
            </view>
          </view>

          <view class="contract-action">
            <button class="action-btn {{contract.isPurchased ? 'manage-btn' : 'buy-btn'}}">
              {{contract.isPurchased ? 'ç®¡ç†åˆçº¦' : contract.isFree ? 'ç«‹å³ä½¿ç”¨' : 'ç«‹å³è´­ä¹°'}}
            </button>
          </view>
        </view>
      </view>
    </block>
  </view>
</view>

<!-- è´­ä¹°ç¡®è®¤å¼¹çª— -->
<view class="modal" wx:if="{{showPurchaseModal}}">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">è´­ä¹°åˆçº¦</text>
      <text class="modal-close" bindtap="closePurchaseModal">âœ•</text>
    </view>

    <view class="purchase-info">
      <view class="contract-info">
        <text class="info-name">{{selectedContract.name}}</text>
        <text class="info-desc">{{selectedContract.description}}</text>
      </view>

      <view class="price-info">
        <text class="price-label">ä»·æ ¼</text>
        <view class="price-detail">
          <text class="current-price">Â¥{{selectedContract.price}}</text>
          <text class="original-price" wx:if="{{selectedContract.originalPrice > selectedContract.price}}">
            åŸä»·Â¥{{selectedContract.originalPrice}}
          </text>
        </view>
      </view>

      <view class="features-info">
        <text class="features-label">åŠŸèƒ½ç‰¹æ€§</text>
        <view class="features-list">
          <view class="feature-item" wx:for="{{selectedContract.features}}" wx:key="*this">
            <text class="feature-check">âœ“</text>
            <text class="feature-text">{{item}}</text>
          </view>
        </view>
      </view>

      <view class="purchase-note">
        <text class="note-text">â€¢ ä¸€æ¬¡è´­ä¹°ï¼Œæ°¸ä¹…ä½¿ç”¨</text>
        <text class="note-text">â€¢ åŒ…å«å…è´¹æ›´æ–°å’ŒæŠ€æœ¯æ”¯æŒ</text>
        <text class="note-text">â€¢ æ”¯æŒå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®</text>
      </view>
    </view>

    <view class="modal-actions">
      <button class="btn-outline" bindtap="closePurchaseModal">å–æ¶ˆ</button>
      <button class="btn-primary" bindtap="purchaseContract">ç¡®è®¤è´­ä¹°</button>
    </view>
  </view>
</view>