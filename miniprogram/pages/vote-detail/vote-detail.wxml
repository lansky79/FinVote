<!-- pages/vote-detail/vote-detail.wxml -->
<view class="container" wx:if="{{!loading}}">
  <!-- æŠ•ç¥¨ä¿¡æ¯ -->
  <view class="card vote-info">
    <view class="vote-header">
      <text class="vote-title">{{vote.title}}</text>
      <view class="vote-status-badge {{vote.status === 'active' ? 'status-active' : 'status-ended'}}">
        {{vote.status === 'active' ? 'è¿›è¡Œä¸­' : 'å·²ç»“æŸ'}}
      </view>
    </view>
    
    <view class="stock-info">
      <text class="stock-code">{{vote.stockCode}}</text>
      <text class="stock-name">{{vote.stockName}}</text>
    </view>
    
    <view class="vote-description" wx:if="{{vote.description}}">
      <text>{{vote.description}}</text>
    </view>
    
    <view class="time-info">
      <view class="time-item">
        <text class="time-label">æŠ•ç¥¨æˆªæ­¢ï¼š</text>
        <text class="time-value">{{vote.endTime}}</text>
      </view>
      <view class="time-item">
        <text class="time-label">ç»“ç®—æ—¶é—´ï¼š</text>
        <text class="time-value">{{vote.settlementTime}}</text>
      </view>
    </view>
  </view>

  <!-- æŠ•ç¥¨ç»Ÿè®¡ -->
  <view class="card vote-stats">
    <view class="stats-header">
      <text class="stats-title">æŠ•ç¥¨ç»Ÿè®¡</text>
      <text class="participants-count">{{vote.participants}}äººå‚ä¸</text>
    </view>
    
    <view class="vote-options">
      <view class="option-item option-up">
        <text class="option-label">çœ‹æ¶¨</text>
        <text class="option-count">{{vote.upVotes}}</text>
        <view class="option-bar">
          <view class="option-progress" style="width: {{vote.participants > 0 ? (vote.upVotes / vote.participants * 100) : 0}}%"></view>
        </view>
      </view>
      
      <view class="option-item option-down">
        <text class="option-label">çœ‹è·Œ</text>
        <text class="option-count">{{vote.downVotes}}</text>
        <view class="option-bar">
          <view class="option-progress" style="width: {{vote.participants > 0 ? (vote.downVotes / vote.participants * 100) : 0}}%"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·æŠ•ç¥¨çŠ¶æ€ -->
  <view class="card user-vote-status" wx:if="{{userVote}}">
    <view class="status-header">
      <text class="status-title">æ‚¨çš„æŠ•ç¥¨</text>
      <text class="status-badge {{userVote.isCorrect ? 'correct' : 'incorrect'}}" wx:if="{{vote.status === 'ended'}}">
        {{userVote.isCorrect ? 'é¢„æµ‹æ­£ç¡®' : 'é¢„æµ‹é”™è¯¯'}}
      </text>
    </view>
    <view class="user-prediction">
      <text>æ‚¨é€‰æ‹©äº†ï¼š</text>
      <text class="prediction-text {{userVote.prediction === 'up' ? 'text-success' : 'text-danger'}}">
        {{userVote.prediction === 'up' ? 'çœ‹æ¶¨' : 'çœ‹è·Œ'}}
      </text>
    </view>
    <view class="points-earned" wx:if="{{userVote.pointsEarned > 0}}">
      <text>è·å¾—ç§¯åˆ†ï¼š+{{userVote.pointsEarned}}</text>
    </view>
  </view>

  <!-- æŠ•ç¥¨æŒ‰é’® -->
  <view class="vote-actions" wx:if="{{vote.status === 'active' && !userVote}}">
    <button class="vote-btn vote-up" bindtap="handleVote" data-prediction="up">
      <text class="vote-btn-icon">ğŸ“ˆ</text>
      <text class="vote-btn-text">çœ‹æ¶¨</text>
    </button>
    <button class="vote-btn vote-down" bindtap="handleVote" data-prediction="down">
      <text class="vote-btn-icon">ğŸ“‰</text>
      <text class="vote-btn-text">çœ‹è·Œ</text>
    </button>
  </view>

  <!-- æŠ•ç¥¨å·²ç»“æŸæˆ–å·²æŠ•ç¥¨æç¤º -->
  <view class="vote-disabled" wx:if="{{vote.status !== 'active' || userVote}}">
    <text class="disabled-text">
      {{vote.status !== 'active' ? 'æŠ•ç¥¨å·²ç»“æŸ' : 'æ‚¨å·²æŠ•ç¥¨'}}
    </text>
  </view>
</view>

<!-- åŠ è½½ä¸­ -->
<view class="loading-container" wx:if="{{loading}}">
  <text>åŠ è½½ä¸­...</text>
</view>