<!-- pages/shop/shop.wxml -->
<view class="container">
  <!-- ç”¨æˆ·ç§¯åˆ†ä¿¡æ¯ -->
  <view class="points-header card">
    <view class="points-info">
      <text class="points-label">æˆ‘çš„ç§¯åˆ†</text>
      <text class="points-number">{{userPoints}}</text>
    </view>
    <view class="points-tips">
      <text class="tips-text">ğŸ’¡ é¢„æµ‹æ­£ç¡®å¯è·å¾—ç§¯åˆ†å¥–åŠ±</text>
    </view>
  </view>

  <!-- å•†å“åˆ†ç±» -->
  <view class="category-tabs">
    <view 
      class="tab-item {{categoryIndex === index ? 'active' : ''}}"
      wx:for="{{categories}}" 
      wx:key="value"
      bindtap="switchCategory"
      data-index="{{index}}"
    >
      <text>{{item.name}}</text>
    </view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="product-list">
    <view 
      class="product-item card"
      wx:for="{{filteredProducts}}" 
      wx:key="id"
      bindtap="showProductDetail"
      data-product="{{item}}"
    >
      <image class="product-image" src="{{item.image}}" mode="aspectFill"></image>
      
      <view class="product-info">
        <text class="product-name">{{item.name}}</text>
        <text class="product-desc text-muted">{{item.description}}</text>
        
        <view class="product-footer">
          <view class="price-info">
            <text class="price-points">{{item.points}}</text>
            <text class="price-label">ç§¯åˆ†</text>
          </view>
          
          <view class="stock-info">
            <text class="stock-text {{item.stock > 0 ? 'in-stock' : 'out-stock'}}">
              {{item.stock > 0 ? 'åº“å­˜' + item.stock : 'ç¼ºè´§'}}
            </text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{filteredProducts.length === 0}}">
    <text class="empty-text">æš‚æ— å•†å“</text>
  </view>
</view>

<!-- å•†å“è¯¦æƒ…å¼¹çª— -->
<view class="modal-overlay {{showModal ? 'show' : ''}}" bindtap="hideModal">
  <view class="modal-content" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">{{selectedProduct.name}}</text>
      <text class="modal-close" bindtap="hideModal">Ã—</text>
    </view>
    
    <view class="modal-body">
      <image class="modal-image" src="{{selectedProduct.image}}" mode="aspectFill"></image>
      
      <view class="product-detail">
        <text class="detail-desc">{{selectedProduct.description}}</text>
        
        <view class="detail-info">
          <view class="info-row">
            <text class="info-label">æ‰€éœ€ç§¯åˆ†ï¼š</text>
            <text class="info-value text-primary">{{selectedProduct.points}}ç§¯åˆ†</text>
          </view>
          
          <view class="info-row">
            <text class="info-label">å‰©ä½™åº“å­˜ï¼š</text>
            <text class="info-value">{{selectedProduct.stock}}ä»¶</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button 
        class="btn-primary exchange-btn"
        bindtap="exchangeProduct"
        disabled="{{selectedProduct.stock <= 0 || userPoints < selectedProduct.points}}"
      >
        {{selectedProduct.stock <= 0 ? 'ç¼ºè´§' : userPoints < selectedProduct.points ? 'ç§¯åˆ†ä¸è¶³' : 'ç«‹å³å…‘æ¢'}}
      </button>
    </view>
  </view>
</view>