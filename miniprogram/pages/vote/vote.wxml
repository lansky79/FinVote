<!-- pages/vote/vote.wxml -->
<view class="container">
  <!-- 筛选器 -->
  <view class="filter-bar">
    <picker 
      range="{{statusOptions}}" 
      range-key="name"
      value="{{statusIndex}}"
      bindchange="handleStatusChange"
    >
      <view class="filter-item">
        <text>{{statusOptions[statusIndex].name}}</text>
        <text class="filter-arrow">▼</text>
      </view>
    </picker>
  </view>

  <!-- 投票列表 -->
  <view class="vote-list">
    <view 
      class="vote-item card" 
      wx:for="{{votes}}" 
      wx:key="id"
      bindtap="goToVoteDetail"
      data-id="{{item.id}}"
    >
      <!-- 投票头部 -->
      <view class="vote-header">
        <view class="vote-title-row">
          <text class="vote-title">{{item.title}}</text>
          <view class="vote-status status-{{item.status}}">
            <text>{{item.status === 'active' ? '进行中' : item.status === 'ended' ? '已结束' : '已结算'}}</text>
          </view>
        </view>
        <text class="vote-desc text-muted">{{item.description}}</text>
      </view>

      <!-- 股票信息 -->
      <view class="stock-info">
        <view class="stock-main">
          <text class="stock-code text-primary">{{item.stockCode}}</text>
          <text class="stock-name">{{item.stockName}}</text>
          <text class="stock-type">{{item.voteType === 'stock' ? '个股' : '指数'}}</text>
        </view>
        <view class="reward-info">
          <text class="reward-text">奖励</text>
          <text class="reward-points text-primary">{{item.pointsReward}}积分</text>
        </view>
      </view>

      <!-- 投票统计 -->
      <view class="vote-stats">
        <view class="stats-row">
          <text class="participants">{{item.participants}}人参与</text>
          <text class="time-info text-muted">{{item.timeText}}</text>
        </view>
        
        <view class="vote-options">
          <view class="option option-up">
            <text class="option-label">看涨</text>
            <text class="option-count">{{item.upVotes}}</text>
            <view class="option-bar">
              <view 
                class="option-fill option-fill-up" 
                style="width: {{item.upPercent}}%"
              ></view>
            </view>
          </view>
          
          <view class="option option-down">
            <text class="option-label">看跌</text>
            <text class="option-count">{{item.downVotes}}</text>
            <view class="option-bar">
              <view 
                class="option-fill option-fill-down" 
                style="width: {{item.downPercent}}%"
              ></view>
            </view>
          </view>
        </view>
      </view>

      <!-- 创建者信息 -->
      <view class="creator-info">
        <image class="creator-avatar" src="{{item.creator.avatarUrl}}" mode="aspectFill"></image>
        <text class="creator-name">{{item.creator.nickName}}</text>
      </view>
    </view>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{hasMore}}">
    <button class="btn-secondary" bindtap="loadMore" disabled="{{loading}}">
      {{loading ? '加载中...' : '加载更多'}}
    </button>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{votes.length === 0 && !loading}}">
    <text class="empty-text">暂无投票</text>
    <button class="btn-primary mt-20" bindtap="goToCreate">创建投票</button>
  </view>

  <!-- 浮动创建按钮 -->
  <view class="fab" bindtap="goToCreate">
    <text class="fab-icon">+</text>
  </view>
</view>